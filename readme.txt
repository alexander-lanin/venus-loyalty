Заметки:
- сделать тип срабатывания акции (при расчете корзины, при закрытии заказа, по таймеру)
это уменьшит кол-во акций для просчета корзины и на закрытии заказа
по таймеру будут запускаться "акции-действия" не привязанные к заказу (сгорание баллов, проставление тегов и т.п.)

- для расчета акций держать все активные акции в memory cache на 30-60 минут
это ускорит расчет и снизит нагрузку на базу для вычетки акций

- для расчета акций реализовать Extension Method для класса "Акция", который принимет на вход корзину
на выходе (результат: success/false) + (корзина: модифицированная при success и не модифицированная при false)
таким образом можно будет параллельно запустить просчет корзины по всем доступным акциям
на выходе мы получим N успешно сработанных акций
нужен некий приоритет акции, чтобы из N выбрать одну
в расчете акции могут быть дополнительные запросы к БД (например: история заказов пользователя)

- в заказ записывать данные для аналитики:
    * начисленные/списанные баллы
    * ID акции по которой был посчитан заказ (может быть несколько акций? например: 2+1 при расчете + акция начисления баллов)
        возможно добавлять ID акции по-позиционно?

- набор Azure Functions по статусам заказов
    * RAW:
        - списать баллы со счета, если они есть в заказе + добавить транзакцию (!!!)
        - погасить промо-код, если он одноразовый
        - уменьшить лимит использования акции, если установлен лимит
    * CLOSED:
        - срабатывание акций с триггером на "закрытие заказа" (тут будет акция начисления баллов по заказу, присвоение тегов) (!!!)
    * CANCELLED:
        - отменить "действия", которые были на статусе RAW
(!!!) – получаются отдельные транзакции по одному заказу, как-то не очень красиво, 
т.к. потом в CosmosDB мы не сможем сделать постраничную вычетку с GROUP BY по заказу :(
как вариант (корявый): модифицировать последнюю транзакцию списания по заказу, добавляя в нее начисления, если была транзкция списания
ну либо заморачиваться и выдумывать схему с подтверждениями баллов

- Azure Function по таймеру
для запуска акций по таймеру (сгорание баллов и т.п.) 


==/==/==/==/==/==/==/==/==/==/==/==/==/==/==/==/==/==/==/==/==/==/==/==/==/==/==/==/==/==/==/==/==/==/==/==/

- как избавиться от двойного расчета акций: order-checkout & order-create?
может АПИ order-create будет сразу принимать расчитанные заказ от сайта/приложения?
можно оставить на 2-й этап, т.к. нужны будут изменения на клиентах
    